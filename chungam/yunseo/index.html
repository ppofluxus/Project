<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OnSense - ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ì•ˆë‚´</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      font-family: system-ui, -apple-system, 'Noto Sans KR', sans-serif;
      display: grid; place-items: center;
      min-height: 100dvh; margin: 0; background:#fff; color:#333;
      text-align:center;
    }
    h1 { font-size:1.5rem; margin:0 0 12px; }
    p  { margin:0 0 16px; color:#555; }
    .btn {
      display:inline-block; padding:12px 18px; border:0; border-radius:10px;
      background:#4caf50; color:#fff; font-size:1rem; cursor:pointer;
    }
    .btn[hidden] { display:none; }
  </style>
</head>
<body>
  <main>
    <h1>ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ì•ˆë‚´ ğŸ§</h1>
    <p id="status">ì ì‹œ í›„ ìë™ìœ¼ë¡œ ì¬ìƒì„ ì‹œë„í•©ë‹ˆë‹¤â€¦</p>

    <!-- ìë™ì¬ìƒ ì‹¤íŒ¨ ì‹œ í‘œì‹œë  ë²„íŠ¼ -->
    <button id="playBtn" class="btn" hidden>â–¶ ìŒì„± ì¬ìƒ</button>

    <audio id="mealAudio" preload="auto" playsinline>
      <source src="./ONsensE-prototype.mp3" type="audio/mpeg" />
      ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </audio>
  </main>

  <script>
    const audio  = document.getElementById('mealAudio');
    const btn    = document.getElementById('playBtn');
    const status = document.getElementById('status');

    async function tryAutoplay() {
      try {
        // ëŒ€ë¶€ë¶„ì˜ ë¸Œë¼ìš°ì €ì—ì„œ í—ˆìš©ë˜ëŠ” 'ë¬´ìŒ ìë™ì¬ìƒ'
        audio.muted = true;
        await audio.play();
        status.textContent = 'ì¬ìƒ ì¤‘ì…ë‹ˆë‹¤. (ê³§ ì†Œë¦¬ê°€ ë‚˜ì˜µë‹ˆë‹¤)';
        // ë°ìŠ¤í¬í†±ì—ì„  ì ì‹œ í›„ ìŒì†Œê±° í•´ì œ (ëª¨ë°”ì¼ SafariëŠ” ì—¬ì „íˆ ì‚¬ìš©ì ì œìŠ¤ì²˜ í•„ìš”í•  ìˆ˜ ìˆìŒ)
        setTimeout(() => { tryUnmute(); }, 300);
      } catch {
        // ìë™ì¬ìƒ ì‹¤íŒ¨ â†’ ë²„íŠ¼ ë…¸ì¶œ
        btn.hidden = false;
        status.textContent = 'ë¸Œë¼ìš°ì € ì •ì±…ìœ¼ë¡œ ìë™ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
      }
    }

    function tryUnmute() {
      try {
        audio.muted = false;
      } catch (_) {}
    }

    btn.addEventListener('click', async () => {
      try {
        audio.muted = false;
        await audio.play();
        btn.hidden = true;
        status.textContent = 'ì¬ìƒ ì¤‘ì…ë‹ˆë‹¤ ğŸ¶';
      } catch (e) {
        status.textContent = 'ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†” ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.';
      }
    });

    // ì†ŒìŠ¤ê°€ ì¤€ë¹„ë˜ë©´ ìë™ì¬ìƒ ì‹œë„
    if (audio.readyState >= 2) {
      tryAutoplay();
    } else {
      audio.addEventListener('canplay', tryAutoplay, { once: true });
      // ë„¤íŠ¸ì›Œí¬ê°€ ëŠë¦´ ë•Œë„ ì¼ì • ì‹œê°„ í›„ ì‹œë„
      setTimeout(tryAutoplay, 2000);
    }
  </script>
</body>
</html>
